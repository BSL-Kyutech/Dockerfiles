version: '3'
services: 
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - UID=${UID} # user id とgroup idを設定する．whoami \ id <name> でわかる
        - GID=${GID}
        - USERNAME=${USERNAME}
        - GROUPNAME=${GROUPNAME}
        - PASSWORD=${PASSWORD}
        - PORT=${PORT}
    #restart:
    #network_mode: "host"
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    ports:  # host id : container id
      - "${PORT}:${PORT}"
    environment:
      - DISPLAY=${DISPLAY}
    volumes:
      #- /home/$USERNAME:/home/$USERNAME # for sharing of home data
      - ./src:/home/$USERNAME/dev_ws/src
      - /tmp/.X11-unix:/tmp/.X11-unix:rw
    entrypoint: >
        jupyter-lab
        --ip 0.0.0.0
        --no-browser
        --allow-root
        --port=$PORT
        --NotebookApp.token='$PASSWORD'
        --notebook-dir=/home/$USERNAME/dev_ws
    
